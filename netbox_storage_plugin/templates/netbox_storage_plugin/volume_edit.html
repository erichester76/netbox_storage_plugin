<form method="post" id="volume-form">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <!-- Main Fields -->
    <div class="form-group">
        <label for="{{ form.name.id_for_label }}">Name:</label>
        {{ form.name }}
    </div>
    <!-- Other Fields -->
    <div class="form-group">
        <label for="{{ form.description.id_for_label }}">Description:</label>
        {{ form.description }}
    </div>
    <div class="form-group">
        <label for="{{ form.type.id_for_label }}">Type:</label>
        {{ form.type }}
    </div>
    <!-- Type-Specific Fields -->
    {% for volume_type, fields in DETAILS_FIELDS.items %}
    <div class="type-specific" data-type="{{ volume_type }}" style="display: none;">
        {% for field_def in fields %}
            {% with field_name=field_def.form_field %}
                <div class="form-group">
                    {{ form[field_name].label_tag }}
                    {{ form[field_name] }}
                    {% if form[field_name].help_text %}
                        <small class="form-text text-muted">{{ form[field_name].help_text }}</small>
                    {% endif %}
                </div>
            {% endwith %}
        {% endfor %}
    </div>
{% endfor %}

    <!-- Hidden Details Field -->
    {{ form.details }}


    <button type="submit" class="btn btn-primary">Save</button>
</form>

<script>
function updateFields() {
    const type = document.getElementById('{{ form.type.id_for_label }}').value;
    document.querySelectorAll('.type-specific').forEach(function(div) {
        div.style.display = (div.dataset.type === type) ? 'block' : 'none';
    });
}

// Set initial visibility (for editing)
updateFields();

// Update visibility when type changes (for creation and editing)
document.getElementById('{{ form.type.id_for_label }}').addEventListener('change', updateFields);
</script>